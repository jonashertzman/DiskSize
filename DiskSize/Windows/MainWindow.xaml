<Window
	x:Class="DiskSize.MainWindow"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:local="clr-namespace:DiskSize"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	Title="{Binding Title, FallbackValue=Disk Size}"
	Width="550"
	Height="330"
	d:DataContext="{d:DesignInstance Type=local:MainWindowViewModel}"
	UseLayoutRounding="True"
	TextOptions.TextFormattingMode="Display"
	Background="{StaticResource Theme.Dialog}"
	ResizeMode="CanResizeWithGrip"
	ContentRendered="Window_ContentRendered"
	Initialized="Window_Initialized"
	Closed="Window_Closed"
	mc:Ignorable="d">

	<Window.Resources>
		<local:GridLengthConverter x:Key="GridLengthConverter" />
		<BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
		<local:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter" />
		<local:InverseBooleanConverter x:Key="InverseBooleanConverter" />

		<ContextMenu x:Key="ContextMenuFileItem">
			<MenuItem Command="local:Commands.OpenContainingFolder" />
			<MenuItem Command="local:Commands.CopyPathToClipboard" />
		</ContextMenu>
	</Window.Resources>

	<Window.CommandBindings>
		<CommandBinding Command="local:Commands.Cancel" Executed="CommandCancel_Executed" CanExecute="CommandCancel_CanExecute" />
	</Window.CommandBindings>

	<Grid>
		<Grid IsEnabled="{Binding Path=GuiFrozen, Converter={StaticResource InverseBooleanConverter}}">
			<Grid.CommandBindings>
				<CommandBinding Command="local:Commands.Analyze" Executed="CommandAnalyze_Executed" />
				<CommandBinding Command="local:Commands.About" Executed="CommandAbout_Executed" />
				<CommandBinding Command="local:Commands.Exit" Executed="CommandExit_Executed" />
				<CommandBinding Command="local:Commands.Up" Executed="CommandUp_Executed" />
				<CommandBinding Command="local:Commands.OpenContainingFolder" Executed="CommandOpenContainingFolder_Executed" CanExecute="CommandOpenContainingFolder_CanExecute" />
				<CommandBinding Command="local:Commands.CopyPathToClipboard" Executed="CommandCopyPathToClipboard_Executed" CanExecute="CommandCopyPathToClipboard_CanExecute" />
			</Grid.CommandBindings>

			<Grid.RowDefinitions>
				<RowDefinition Height="Auto" />
				<RowDefinition Height="Auto" />
				<RowDefinition Height="Auto" />
				<RowDefinition Height="*" />
				<RowDefinition Height="Auto" />
			</Grid.RowDefinitions>

			<!--  Menu  -->
			<Grid Grid.Row="0" Background="{StaticResource Theme.Window}">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*" />
					<ColumnDefinition Width="Auto" />
				</Grid.ColumnDefinitions>
				<Menu Padding="3">
					<MenuItem Header="File">
						<MenuItem Header="Exit" Command="local:Commands.Exit" />
					</MenuItem>
					<MenuItem Header="Edit">
						<MenuItem Header="Find" Command="local:Commands.Find" />
						<MenuItem Header="Find Next" Command="local:Commands.FindNext" />
						<MenuItem Header="Find Previous" Command="local:Commands.FindPrevious" />
					</MenuItem>
					<MenuItem Header="Tools">
						<MenuItem Header="Options" Command="local:Commands.Options" />
					</MenuItem>
					<MenuItem Header="Help">
						<MenuItem Header="About" Command="local:Commands.About" />
					</MenuItem>
				</Menu>
				<StackPanel x:Name="UpdatePanel" Grid.Column="1" Orientation="Horizontal" Visibility="{Binding Path=NewBuildAvailable, Converter={StaticResource BooleanToVisibilityConverter}}">
					<Label Margin="3,3,6,3" Padding="0" VerticalAlignment="Center">
						<Hyperlink RequestNavigate="Hyperlink_OpenHomepage" NavigateUri="https://github.com/jonashertzman/DiskSize/blob/master/README.md">New Version Available</Hyperlink>
					</Label>
					<!--<Button BorderThickness="0" Margin="3" Padding="0" Foreground="{StaticResource {x:Static SystemColors.ScrollBarBrushKey} }" Background="Transparent" VerticalAlignment="Center" Click="Button_Click">
							&#x274C;
						</Button>-->
				</StackPanel>
			</Grid>

			<!--  Main Toolbar  -->
			<Border x:Name="ToolbarMain" Grid.Row="1" DockPanel.Dock="Top" BorderThickness="0,1">
				<Border.Background>
					<LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
						<GradientStop Offset="0" Color="{Binding WindowBackground.Color, FallbackValue=White}" />
						<GradientStop Offset="1" Color="{Binding DialogBackground.Color, FallbackValue=#FFF0F0F0}" />
					</LinearGradientBrush>
				</Border.Background>

				<StackPanel Orientation="Horizontal">

					<Button Style="{StaticResource ToolbarButton}" Command="local:Commands.Analyze">
						<StackPanel Orientation="Horizontal">
							<ContentPresenter ContentTemplate="{StaticResource AnalyzeIcon}" Style="{StaticResource CommonButtonIcon}" />
							<TextBlock Text="Analyze" Style="{StaticResource CommonButtonLabel}" />
						</StackPanel>
					</Button>

					<Button Style="{StaticResource ToolbarButton}" Command="local:Commands.Up">
						<StackPanel Orientation="Horizontal">
							<ContentPresenter ContentTemplate="{StaticResource UpIcon}" Style="{StaticResource CommonButtonIcon}" />
							<TextBlock Text="Go Parent Folder" Style="{StaticResource CommonButtonLabel}" />
						</StackPanel>
					</Button>

				</StackPanel>
			</Border>

			<!--  Address Bar  -->
			<Grid Grid.Row="2">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*" />
					<ColumnDefinition Width="Auto" />
				</Grid.ColumnDefinitions>

				<local:ErrorTextBox x:Name="AddressTextBox" d:Text="C:\temp" Text="{Binding Path, UpdateSourceTrigger=LostFocus}" BorderThickness="0" />
				<Button x:Name="BrowseButton" Grid.Column="1" Width="20" Height="21" HorizontalAlignment="Right" VerticalAlignment="Center" Content="..." BorderThickness="0" Click="BrowseButton_Click" />
			</Grid>

			<!--  Tree  -->
			<Border Grid.Row="3" Grid.Column="0" BorderThickness="0,1" AllowDrop="True">
				<Grid Name="LeftFolderGrid" MouseWheel="TreeGrid_MouseWheel">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="*" />
						<ColumnDefinition Width="Auto" />
					</Grid.ColumnDefinitions>
					<Grid.RowDefinitions>
						<RowDefinition Height="auto" />
						<RowDefinition Height="*" />
						<RowDefinition Height="auto" />
					</Grid.RowDefinitions>

					<Border BorderThickness="0,0,0,1">
						<ScrollViewer Name="TreeColumns" ScrollChanged="TreeColumns_ScrollChanged" VerticalScrollBarVisibility="Hidden" HorizontalScrollBarVisibility="Hidden">
							<Grid Name="LeftColumns" HorizontalAlignment="Left">
								<Grid.ColumnDefinitions>
									<ColumnDefinition Width="{Binding NameColumnWidth, Mode=TwoWay, Converter={StaticResource GridLengthConverter}}" MinWidth="50" />
									<ColumnDefinition Width="4" />
									<ColumnDefinition Width="{Binding SizeColumnWidth, Mode=TwoWay, Converter={StaticResource GridLengthConverter}}" MinWidth="50" />
									<ColumnDefinition Width="4" />
									<ColumnDefinition Width="{Binding DateColumnWidth, Mode=TwoWay, Converter={StaticResource GridLengthConverter}}" MinWidth="50" />
									<ColumnDefinition Width="4" />
									<ColumnDefinition Width="{Binding FilesColumnWidth, Mode=TwoWay, Converter={StaticResource GridLengthConverter}}" MinWidth="50" />
									<ColumnDefinition Width="4" />
								</Grid.ColumnDefinitions>

								<Button Name="NameColumn" Grid.Column="0" Style="{StaticResource FlatButton}" Click="GridColumn_Click" CommandParameter="{x:Static local:SortColumn.Name}">
									<TextBlock Text="Name" TextTrimming="CharacterEllipsis" SizeChanged="TreeColumns_Resized" Style="{StaticResource StyledTextBlock}" />
								</Button>
								<GridSplitter Grid.Column="1" Width="4" HorizontalAlignment="Left" BorderThickness="0,0,1,0" Focusable="False" Style="{StaticResource CommonGridSpliter}" />

								<Button Name="SizeColumn" Grid.Column="2" Style="{StaticResource FlatButton}" Click="GridColumn_Click" CommandParameter="{x:Static local:SortColumn.Size}">
									<TextBlock Name="SizeColumnHeader" Padding="0,0,2,0" Text="Size" TextTrimming="CharacterEllipsis" SizeChanged="TreeColumns_Resized" Style="{StaticResource StyledTextBlock}" TextAlignment="Right" />
								</Button>
								<GridSplitter Grid.Column="3" Width=" 4" HorizontalAlignment="Left" BorderThickness="0,0,1,0" Focusable=" False" Style="{StaticResource CommonGridSpliter}" />

								<Button Name="DateColumn" Grid.Column="4" Style="{StaticResource FlatButton}" Click="GridColumn_Click" CommandParameter="{x:Static local:SortColumn.Date}">
									<TextBlock Text="Date" TextTrimming="CharacterEllipsis" SizeChanged="TreeColumns_Resized" Style="{StaticResource StyledTextBlock}" />
								</Button>
								<GridSplitter Grid.Column="5" Width=" 4" HorizontalAlignment="Left" BorderThickness="0,0,1,0" Focusable=" False" Style="{StaticResource CommonGridSpliter}" />

								<Button Name="FilesColumn" Grid.Column="6" Style="{StaticResource FlatButton}" Click="GridColumn_Click" CommandParameter="{x:Static local:SortColumn.Files}">
									<TextBlock Padding="0,0,2,0" Text="Files" TextTrimming="CharacterEllipsis" SizeChanged="TreeColumns_Resized" Style="{StaticResource StyledTextBlock}" TextAlignment="Right" />
								</Button>
								<GridSplitter Grid.Column="7" Width=" 4" HorizontalAlignment="Left" BorderThickness="0,0,1,0" Focusable=" False" Style="{StaticResource CommonGridSpliter}" />

							</Grid>
						</ScrollViewer>
					</Border>

					<Border Grid.Column="1" BorderThickness="0,0,0,1" />

					<Border Grid.Row="1" Grid.Column="0" BorderThickness="0" Background="{StaticResource Theme.Window}">
						<local:TreeControl x:Name="Tree" Focusable="True" ContextMenu="{StaticResource ContextMenuFileItem}" SelectionChanged="Tree_SelectionChanged" RootItem="{Binding RootItem}" HorizontalOffset="{Binding Value, ElementName=HorizontalScrollbar, Mode=TwoWay}" VerticalOffset="{Binding ElementName=VerticalTreeScrollbar, Path=Value, Mode=TwoWay}" UpdateTrigger="{Binding UpdateTrigger, Mode=TwoWay}" FocusVisualStyle="{x:Null}" SortBy="{Binding SortBy}" SortDirection="{Binding SortDirection}" />
					</Border>
					<ScrollBar Name="HorizontalScrollbar" Grid.Row="2" ValueChanged="HorizontalScrollbar_ValueChanged" Orientation="Horizontal" SmallChange="10" />
					<ScrollBar Name="VerticalTreeScrollbar" Grid.Row="1" Grid.Column="2" SmallChange="1" LargeChange="{Binding ElementName=Tree, Path=VisibleLines}" ViewportSize="{Binding ElementName=Tree, Path=VisibleLines, Mode=TwoWay}" Maximum="{Binding ElementName=Tree, Path=MaxVerticalScroll, Mode=TwoWay}" />
				</Grid>
			</Border>

			<!--  Status Bar  -->
			<Border Grid.Row="4" Padding="4" BorderThickness="0">
				<TextBlock x:Name="StatusBar" Text="Status" />
			</Border>

		</Grid>


		<!--  Analyze Progress  -->
		<Grid d:Visibility="Hidden" Background="#00000000" Cursor="Wait" Visibility="{Binding ProgressVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
			<!--  Workaround to not fuckup the cleartype rendering  -->
			<Border Width="{Binding ActualWidth, ElementName=ProgressPanel}" Height="{Binding ActualHeight, ElementName=ProgressPanel}" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="{Binding Visibility, ElementName=ProgressPanel}" Background="{StaticResource Theme.Window}">
				<Border.Effect>
					<DropShadowEffect BlurRadius="25" ShadowDepth="0" Opacity=".35" />
				</Border.Effect>
			</Border>
			<Border x:Name="ProgressPanel" HorizontalAlignment="Center" VerticalAlignment="Center" BorderThickness="1" Cursor="Arrow">
				<StackPanel Margin="5">
					<Label HorizontalAlignment="Center" Content="Analyzing..." />
					<StackPanel Orientation="Horizontal">
						<ProgressBar x:Name="ProgressBarAnalyze" Width="300" Margin="5" Background="{StaticResource Theme.Dialog}" Minimum="0" Maximum="100" Value="40" />
						<Button x:Name="ButtonCancelCompare" HorizontalAlignment="Right" Style="{StaticResource CommonButton}" Content="Cancel" Command="local:Commands.Cancel" />
					</StackPanel>
				</StackPanel>
			</Border>
		</Grid>

	</Grid>
</Window>
